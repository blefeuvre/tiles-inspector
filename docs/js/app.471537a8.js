(function(e){function t(t){for(var o,i,n=t[0],u=t[1],l=t[2],d=0,h=[];d<n.length;d++)i=n[d],s[i]&&h.push(s[i][0]),s[i]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);c&&c(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],o=!0,n=1;n<r.length;n++){var u=r[n];0!==s[u]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var o={},s={app:0},a=[];function i(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=o,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],u=n.push.bind(n);n.push=t,n=n.slice();for(var l=0;l<n.length;l++)t(n[l]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var o=r("64a9"),s=r.n(o);s.a},1:function(e,t){},"1ee4":function(e,t,r){},2:function(e,t){},"2d6d":function(e,t,r){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);var o=r("2b0e"),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("div",{attrs:{id:"top"}},[r("h1",[e._v("Vector Inspector")]),e._v("Look inside the contents of vector tiles from third party sources!"),e._m(0),e._v("Paste the URL of one vector tile ("),r("code",[e._v(".../8/531/489.pbf")]),e._v(") OR a TileJSON endpoint ("),r("code",[e._v(".../index.json")]),e._v(")"),r("br"),r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],attrs:{id:"url",placeholder:"https://tiles.planninglabs.nyc/data/v3/14/4826/6157.pbf"},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}}),r("br"),r("small",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.cors,expression:"cors"}],attrs:{id:"cors",type:"checkbox"},domProps:{checked:Array.isArray(e.cors)?e._i(e.cors,null)>-1:e.cors},on:{change:function(t){var r=e.cors,o=t.target,s=!!o.checked;if(Array.isArray(r)){var a=null,i=e._i(r,a);o.checked?i<0&&(e.cors=r.concat([a])):i>-1&&(e.cors=r.slice(0,i).concat(r.slice(i+1)))}else e.cors=s}}}),r("label",{attrs:{for:"cors"}},[e._v("Use CORS proxy")])])]),r("div",{attrs:{id:"middle"}},[r("div",{attrs:{id:"sidepanel"}},[r("h3",[e._v("Layers")]),r("div",{attrs:{id:"layers"}},[r("AttributesTable",{attrs:{layers:e.layers,values:e.values,focusedAttribute:e.focusedAttribute,focusedLayer:e.focusedLayer},on:{clickAttribute:e.summariseAttribute}}),r("AttributeSummary",{attrs:{sortedValueCounts:e.sortedValueCounts,attributeName:e.focusedAttribute,focusedValue:e.focusedValue},on:{hoverValue:function(t){e.focusedValue=t}}}),r("input",{directives:[{name:"model",rawName:"v-model",value:e.showBoundaries,expression:"showBoundaries"}],attrs:{id:"showbBoundaries",type:"checkbox"},domProps:{checked:Array.isArray(e.showBoundaries)?e._i(e.showBoundaries,null)>-1:e.showBoundaries},on:{change:function(t){var r=e.showBoundaries,o=t.target,s=!!o.checked;if(Array.isArray(r)){var a=null,i=e._i(r,a);o.checked?i<0&&(e.showBoundaries=r.concat([a])):i>-1&&(e.showBoundaries=r.slice(0,i).concat(r.slice(i+1)))}else e.showBoundaries=s}}}),r("label",{attrs:{for:"showBoundaries"}},[e._v("Show tile boundaries")])],1)]),r("MapComponent",{attrs:{layers:e.layers,xyzUrl:e.xyzUrl,focusValue:e.focusedValue,focusLayer:e.focusedLayer,focusField:e.focusedAttribute},on:{"values-update":e.updateValues,move:e.updateAttributeSummary}})],1),e._m(1)])},a=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"credit"},[e._v("By Steve Bennett (@stevage1) - "),r("a",{attrs:{href:"http://hire.stevebennett.me"}},[e._v("hire.stevebennett.me")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"bottom"}},[e._v("Source: "),r("a",{attrs:{href:"https://github.com/stevage/vector-inspector"}},[e._v("https://github.com/stevage/vector-inspector")])])}],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"AttributesTable"}},e._l(e.layers,function(t){return r("div",{style:{color:t._color},attrs:{id:"layer"}},[e._v(e._s(t.name)),r("table",{attrs:{id:"attributes"}}),e._l(t._keys,function(o){return r("tr",{attrs:{id:"attribute"},on:{click:function(r){e.$emit("clickAttribute",o,t.name)}}},[r("td",{staticStyle:{width:"20px"}},[o===e.focusedAttribute&&e.focusedLayer===t.name?r("span",[e._v("→")]):e._e()]),r("td",{staticClass:"key"},[e._v(e._s(o))]),r("td",{staticClass:"key"},[e._v(e._s(e.values[t.name]&&e.values[t.name][o]))])])})],2)}))},n=[],u={name:"AttributesTable",props:{layers:Array,values:{type:Object,default:()=>({})},focusedAttribute:String,focusedLayer:String},data:()=>({}),created(){window.AttributesTable=this}},l=u,c=(r("700a"),r("2877")),d=Object(c["a"])(l,i,n,!1,null,"544d9ff1",null);d.options.__file="AttributesTable.vue";var h=d.exports,f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.attributeName?r("div",{attrs:{id:"AttributeSummary"}},[r("table",[r("tr",[r("td",{staticStyle:{width:"20px"}}),r("th",[e._v('Value of "'+e._s(e.attributeName)+'"')]),r("th",[e._v("Count")])]),e._l(e.sortedValueCounts,function(t){var o=t[0],s=t[1];return r("tr",{on:{mouseover:function(t){e.$emit("hoverValue",o,s)},mouseout:function(t){e.$emit("hoverValue")}}},[r("td",{staticStyle:{width:"20px"}},[o===e.focusedValue?r("span",[e._v("→")]):e._e()]),r("td",[e._v(e._s(o))]),r("td",[e._v(e._s(s))])])})],2)]):e._e()},p=[],m={name:"AttributeSummary",props:{attributeName:String,sortedValueCounts:Array,focusedValue:[String,Number]},data:()=>({}),created(){window.AttributeSummary=this}},y=m,v=(r("5e91"),Object(c["a"])(y,f,p,!1,null,"2d83a05d",null));v.options.__file="AttributeSummary.vue";var b=v.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"map"}})},w=[];r("ac6d");const g=r("e192");var S={name:"Map",props:{xyzUrl:String,layers:{type:Array,default:()=>[]},focusLayer:String,focusField:String,focusValue:[String,Number]},data:()=>({ourLayers:[]}),created(){window.MapComponent=this},mounted(){this.initMap()},watch:{xyzUrl:{handler(){this.updateSource()}},layerStyles(e,t){this.map.U.onLoad(()=>{this.updateSource(),t.forEach(({id:e})=>this.map.U.removeLayer(e)),e.forEach(e=>this.map.U.addLayer(e)),e.filter(({type:e})=>"fill"===e).forEach(({id:e})=>this.map.U.hoverFeatureState(e)),e.filter(({type:e})=>"line"===e||"circle"===e).forEach(({id:e})=>this.map.U.hoverPointer(e))})},focus(){this.map.U.removeLayer(["focus-line","focus-circle"]),void 0!==this.focusValue&&(this.map.U.addLine("focus-line","source",{sourceLayer:this.focusLayer,lineColor:"yellow",lineWidth:4,lineOpacity:.7,filter:["==",this.focusField,this.focusValue]}),this.map.U.addCircle("focus-circle","source",{sourceLayer:this.focusLayer,circleColor:"yellow",circleRadius:12,circleOpacity:.7,filter:["all",["==",this.focusField,this.focusValue],["==","$type","Point"]]}))}},computed:{focus(){return this.focusLayer+this.focusField+this.focusValue},layerStyles(){return[...this.layers.map(({name:e,_color:t})=>({id:`${e}-fill`,source:"source",type:"fill",sourceLayer:e,fillColor:t,fillOpacity:["case",["to-boolean",["feature-state","hover"]],.7,.2],fillOutlineColor:["case",["to-boolean",["feature-state","hover"]],"black","transparent"],filter:["any",["==","$type","Polygon"]]})),...this.layers.map(({name:e,_color:t})=>({id:`${e}-line`,type:"line",source:"source",sourceLayer:e,lineColor:["case",["to-boolean",["feature-state","hover"]],"black",t],lineWidth:{stops:[[11,1],[14,5]]},filter:["any",["==","$type","LineString"],["==","$type","Polygon"]]})),...this.layers.map(({name:e,_color:t})=>({id:`${e}-circle`,type:"circle",source:"source",sourceLayer:e,circleColor:t,circleRadius:{stops:[[11,2],[14,5]]},filter:["==","$type","Point"]}))]}},methods:{updateSource(){this.map.U.removeSource("source"),this.map.addSource("source",{type:"vector",tiles:[this.xyzUrl]})},resetValues(){for(const e of this.layers)this.$set(this.values,e,{})},initMap(){g.accessToken="pk.eyJ1Ijoic3RldmFnZSIsImEiOiJjam5kcGMzNjMydnNxM2ttc2toamo3Yzk2In0.JLncOwxdMGtouRcPNJtnbQ";window.location.hash.match(/aus/);let e=new g.Map({container:"map",style:"mapbox://styles/mapbox/light-v8",maxTileCacheSize:0,hash:"loc"});e.addControl(new g.NavigationControl),r("ef12").init(e),window.map=e,this.map=e;const t=e=>e.replace(/(-line|-circle|-fill)$/,"");e.on("mousemove",r=>{const o={};this.layerStyles.forEach(({id:s})=>{const[a]=e.queryRenderedFeatures(r.point,{layers:[s]});if(a){const e=t(s);o[e]=a.properties}}),this.$emit("values-update",o)}),e.on("moveend",()=>this.$emit("move"))}}},A=S,x=(r("5783"),Object(c["a"])(A,_,w,!1,null,"0a386ea1",null));x.options.__file="Map.vue";var L=x.exports;r("c11e");const k=r("30dc"),C=r("740e").VectorTile,V=r("7915"),j=r("470b"),O=(r("dfe1"),["#1f78b4","#33a02c","#e31a1c","#ff7f00","hsl(90,50%,30%)","#fb9a99","#cab2d6","#fdbf6f","hsl(240,90%,60%)","#6a3d9a","#bb5","#b15928",...Object.keys(r("f2dd"))]);var $={name:"app",components:{AttributesTable:h,AttributeSummary:b,MapComponent:L},data:()=>({url:(window.location.hash.match(/url=([^&]+)/)||[])[1]||"",layers:[],values:{},cors:!1,tilejsonXyzUrl:"",showBoundaries:!1,focusedLayer:void 0,focusedAttribute:void 0,focusedValue:void 0,valueCounts:{},sortedValueCounts:[]}),mounted(){window.setTimeout(()=>{localStorage.getItem("url")&&this.url},1e3),window.App=this},computed:{xyzUrl(){return this.tilejsonXyzUrl||this.url.replace(/\/\d+\/\d+\/\d+\./,"/{z}/{x}/{y}.")},tileJsonUrl(){return this.url.replace(/\/\d+\/\d+\/\d+\.[a-zA-Z]*/,"/index.json")}},watch:{url:{handler(){this.refresh(),localStorage.setItem("url",this.url),window.location.hash=window.location.hash.replace(/(\??&?url=[^&]+|$)/,`&url=${this.url}`)},immediate:!0},cors(){this.refresh()},showBoundaries(){window.map.showTileBoundaries=this.showBoundaries}},methods:{summariseAttribute(e,t){this.focusedAttribute=e,this.focusedLayer=t,this.updateAttributeSummary()},updateAttributeSummary(){if(!this.focusedAttribute)return;const e=window.map.querySourceFeatures("source",{sourceLayer:this.focusedLayer});this.valueCounts=new Map;for(const{properties:t}of e){const e=t[this.focusedAttribute],r=this.valueCounts.get(e);this.valueCounts.set(e,(r||0)+1)}this.sortedValueCounts=Array.from(this.valueCounts.entries()).sort(([,e],[,t])=>t-e)},updateValues(e){this.values=e},refresh(){const e=(e,t,r)=>{return k({url:this.cors?"https://cors-anywhere.herokuapp.com/"+e:e,headers:this.cors?{Origin:window.location.host}:{},...t},r)};this.url.match(/\.(pbf|mvt)/)?(e(this.url,{encoding:null},(e,t,r)=>{try{r=j.gunzipSync(r)}catch(s){}if(!r)return this.layers=[],void console.log("No body when requesting ",this.url);const o=new C(new V(r));console.log(o),this.layers=Object.keys(o.layers).map((e,t)=>({...o.layers[e],_color:O[t]}))}),e(this.tileJsonUrl,{json:!0},(e,t,r)=>{r.center&&window.map.panTo(r.center,{zoom:r.center[2]}),console.log(r)})):this.url.match(/\.json/)?e(this.url,{json:!0},(e,t,r)=>{this.layers=r.vector_layers.map((e,t)=>({_color:O[t],name:e.id,_keys:Object.keys(e.fields)})),this.tilejsonXyzUrl=r.tiles[0]}):(this.layers=[],this.values={})}}},U=$,B=(r("034f"),Object(c["a"])(U,s,a,!1,null,null,null));B.options.__file="App.vue";var M=B.exports;o["a"].config.productionTip=!1,new o["a"]({render:function(e){return e(M)}}).$mount("#app")},5783:function(e,t,r){"use strict";var o=r("dace"),s=r.n(o);s.a},"5e91":function(e,t,r){"use strict";var o=r("2d6d"),s=r.n(o);s.a},"64a9":function(e,t,r){},"700a":function(e,t,r){"use strict";var o=r("1ee4"),s=r.n(o);s.a},dace:function(e,t,r){}});
//# sourceMappingURL=app.471537a8.js.map